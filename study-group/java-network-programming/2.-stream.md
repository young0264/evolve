---
description: 스트림
---

# 2. Stream

*   **출력 스트림**

    *   자바의 기본 출력 클래스는 java.io.OutputStream 이다.\


        \[OutputStream을 상속받는 여러 클래스들]

        <figure><img src="../../.gitbook/assets/스크린샷 2024-01-02 23.09.54.png" alt=""><figcaption><p>OutputStream을 상속받는 여러 클래스들</p></figcaption></figure>
    * **TCP/IP**에서 write() 출력 메서드에서 한번에 **한 바이트씩 출력하면 매우 비효율적**이게 된다. 이걸 한 줄씩 byte\[] 배열에 저장 후 OutputStream에 ‘**out.write(line)**‘ 의 형태처럼 **버퍼링 하게 구현**하게 구현이 된다. 그래서 TCP/IP 에서는 메모리에 데이터를 쌓아 두고, 일정 수치에 도달하거나 특정 시간을 초과할 경우 데이터를 전송한다. 이렇게 한번에 전송하는 데이터가 1바이트씩 반복해서 보내는 것보다 훨씬 빠르게 된다. 스트림은 또한 네트워크 하드웨어가 아닌 자바 코드 내에서 직접 버퍼링 할 수 있다.(BufferedOutputStream이나 BufferedWriter사용)
    * 이런 버퍼링이 사용되기 때문에 **출력 스트림**을 사용시 **flush()가 중요**해진다. **HTTP** Keep-Alive 를 기본으로 지원하는 HTTP 1.1버전을 예로들어보자. 서버에 300바이트에 해당하는 데이터 요청을 보냈다고 가정해보자. Non-Pipeline이라는 가정하에서는 요청을 보낸 후 추가 다른 요청을 보내기 전에 이미 보낸 요청을 기다리게 될 것입니다. 만약 **출력 스트림의 크기**가 1,024 바이트 크기를 가지고 있다면, 출력 스트림은 버퍼가 가득 차지 않았기 때문에 버퍼 안의 데이터를 전송하지 않고 추가적인 데이터가 올 때까지 기다립니다. 서버로부터 받을 데이터가 없어 응답이 오지 않게 된다면 버퍼가 가득차지 않은 상태에서 **flush()메소드**를 사용해 버퍼 내용을 **강제로 전송**함으로써 데드락(deadlock)상태를 **해제**합니다.
    *   스트림이 버퍼링이 되는지를 판단 후 플러시를 하는 것 보다 **항상 플러시를 하는 것이 좋다**. 특정 스트림의 참조를 획득하는 방법에 따라 해당 스트림의 버퍼링 여부를 판단하기 어려운 상황도 발생하기 때문이다.(System.out은 알아서 버퍼링을 함) 필요없는 스트림에 불필요한 플러시가 발생할 수는 있지만부하는 무시해도 될 수준이다. 하지만 플러시가 꼭 필요한 상황에 플러시를 하지 않게 될 경우 프로그램 종료, 데드락 등의 상황이 나타날 수 있으며 진단하기가 매우 어렵다는 큰 단점이 있다.

        **다 쓴 스트림은 항상 닫기전에 플러시해야** 하며, 그렇지 않을 경우 스트림이 닫힐 때 버퍼 안에 남아 있는 데이터가 손실될 수 있다.
    * 마지막으로 스트림 사용이 끝나면 **close() 메소드를 호출하여 스트림을 닫는다.** (leak 이슈)파일이나 포트같은 스트림에서는 **리소스를 해제**한다. 네트워크 연결 스트림이면 **네트워크 연결이 종료**된다. 출력 스트림을 닫은 후에 쓰기를 시도하면 IOException이 발생한다. **그러나** 몇몇 종류의 스트림은 닫은 후에도 해당 스트림의 객체(object)에 **일부 작업이 허용된다.** 예를 들어 이미 닫힌 ByteArrayOutputStream은 여전히 바이트 배열로의 전환이 가능하며, DigetOutputStream은 여전히 다이제스트(digest)값이 반환된다.
    * OutputStream은 Closeable interface를 상속받는다. 그리고 close메서드를 자동으로 호출하므로 finally 구문에서의 인스턴스 해제 패턴(dispose pattern)은 필요하지 않다.
      * `public interface Closeable extends AutoCloseable {...}`&#x20;
      * `public abstract class OutputStream implements Closeable, Flushable{...}`\


    <figure><img src="../../.gitbook/assets/스크린샷 2024-01-03 00.26.23.png" alt="" width="375"><figcaption><p>OutputStream에서의 close() 메서드</p></figcaption></figure>





